<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard - Dolce Vita</title>
    <link rel="stylesheet" href="login.css">
</head>
<body>

<h2>Admin Dashboard</h2>

<button onclick="logout()">Logout</button>

<hr>

<h3>Add New Product</h3>

<input type="text" id="name" placeholder="Product Name"><br>
<input type="text" id="category" placeholder="Category"><br>
<input type="number" id="price" placeholder="Price"><br>
<input type="number" id="stock" placeholder="Stock"><br>
<input type="text" id="image_url" placeholder="Image URL"><br>
<textarea id="description" placeholder="Description"></textarea><br>

<button onclick="addProduct()">Add Product</button>

<hr>

<h3>All Products</h3>
<div id="productList"></div>

<script src="js/auth.js"></script>
<script>
requireAdmin();
</script>

<script>
const API_URL = "http://127.0.0.1:5000/api";

async function addProduct() {

    const token = localStorage.getItem("token");

    const res = await fetch(`${API_URL}/products`, {
        method: "POST",
        headers: {
            "Content-Type":"application/json",
            "Authorization": token
        },
        body: JSON.stringify({
            name: document.getElementById("name").value,
            category: document.getElementById("category").value,
            price: document.getElementById("price").value,
            stock: document.getElementById("stock").value,
            image_url: document.getElementById("image_url").value,
            description: document.getElementById("description").value
        })
    });

    const data = await res.json();

    if(res.ok){
        alert("Product added!");
        loadProducts();
    } else {
        alert(data.error || "Error adding product");
    }
}

async function loadProducts(){

    const res = await fetch(`${API_URL}/products`);
    const products = await res.json();

    const container = document.getElementById("productList");
    container.innerHTML = "";

    products.forEach(p => {
        container.innerHTML += `
            <div style="border:1px solid #ccc; padding:10px; margin:10px;">
                <h4>${p.name}</h4>
                <p>K ${p.price}</p>
                <button onclick="deleteProduct(${p.id})">Delete</button>
            </div>
        `;
    });
}

async function deleteProduct(id){

    const token = localStorage.getItem("token");

    await fetch(`${API_URL}/products/${id}`, {
        method: "DELETE",
        headers: {
            "Authorization": token
        }
    });

    loadProducts();
}

document.addEventListener("DOMContentLoaded", loadProducts);
</script>

</body>
</html>
